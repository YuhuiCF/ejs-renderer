<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: test/integration/test/steps.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: test/integration/test/steps.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

const {log} = require('console');
const path = require('path');
const Promise = require('bluebird');

const {exec, readdir, readFile, stat} = require('./helper');

/**
 * @namespace tests
 */

/**
 * @namespace steps
 */

const output = 'test/integration/dist';
const template = 'test/integration/templates';


const GIVEN = {
  removeOutput,
};

const WHEN = {
  render,
};

const THEN = {
  readOutput,
};

const stepsModule = {
  GIVEN,
  WHEN,
  THEN,
};

module.exports = stepsModule;

/**
 * read and validate output files
 * @param {object[]} outputFiles
 * @return {Promise}
 */
function readOutput(outputFiles) {
  return readdir(output).then((files) => {
    expect(files.length).toBe(outputFiles.length);

    const promises = [];
    outputFiles.forEach((file, i) => {
      const index = i;
      expect(files[index]).toBe(file.outputFileName);

      promises.push(
        readFile(path.resolve(output, files[index]), 'utf8')
          .then((data) => {
            expect(data).toBe(file.outputContent);
          })
      );
    });

    return Promise.all(promises);
  });
}

/**
 * @memberof steps
 * @description remove output directory
 * @param {string} path
 * @return {Promise}
 */
function removeOutput() {
  const path = output;
  return exec(`rm -rf ${path}`)
    .then(() => {
      return stat(path);
    })
    .then(() => {}, (err) => {
      expect(err.code).toBe('ENOENT');
    })
  ;
}

/**
 * @memberof steps
 * @description render files by command
 * @param {string} inputParam - -i or --input
 * @param {string} input - input value
 * @param {string} templateParam - -t or --template
 * @param {string} outputParam - -o or --outpu
 * @param {boolean} skipExit - skip process.exit error by adding || true
 * @param {string} expectedStdout
 * @param {string} expectedStderr
 * @return {Promise}
 */
function render(
  inputParam, input, templateParam, outputParam, skipExit,
  expectedStdout, expectedStderr
) {
  const command =
    `node app/index.js ${inputParam} ${input} ` +
    `${templateParam} ${template} ${outputParam} ${output}` +
    `${skipExit ? ' || true' : ''}`
  ;
  log(`========== RENDER COMMAND ==========
${command}`);

  return exec(command).then(({stdout, stderr}) => {
    expect(stdout).toBe(expectedStdout, 'stdout');
    expect(stderr).toBe(expectedStderr, 'stderr');
  });
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Namespaces</h3><ul><li><a href="steps.html">steps</a></li><li><a href="tests.html">tests</a></li><li><a href="tests.directory.html">directory</a></li><li><a href="tests.error.html">error</a></li><li><a href="tests.file.html">file</a></li></ul><h3>Global</h3><ul><li><a href="global.html#checkFile">checkFile</a></li><li><a href="global.html#exec">exec</a></li><li><a href="global.html#fatal">fatal</a></li><li><a href="global.html#getCurrentTime">getCurrentTime</a></li><li><a href="global.html#getOptions">getOptions</a></li><li><a href="global.html#getRandomInvalidFile">getRandomInvalidFile</a></li><li><a href="global.html#getRandomValidFile">getRandomValidFile</a></li><li><a href="global.html#readOutput">readOutput</a></li><li><a href="global.html#renderContentFile">renderContentFile</a></li><li><a href="global.html#setArgs">setArgs</a></li><li><a href="global.html#start">start</a></li><li><a href="global.html#treatArgsInput">treatArgsInput</a></li><li><a href="global.html#writeToFile">writeToFile</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.4</a> on Fri Aug 18 2017 23:16:07 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
